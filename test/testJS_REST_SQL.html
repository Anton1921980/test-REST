<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <style type="text/css">
        p {

            font-style:bold; color:green;
        }
    </style>
</head>

<body>
    <h1>JS</h1>
    <h3>1. Days between dates</h3>
    <input type="button" id="1" class="button" value="show solution" />
    <br>
    <br>
    <section id="section1" class="section" style="display:none">
        <p>1.1.	Extend JS Date object with a method daysTo() which returns number of complete days between any pair of JS date objects: d1.daysTo(d2) should return quantity of complete days from d1 to d2. </p>
        <div>Input dates</div>
        <input type="text" size="40" id="day1" value="Jan 01 2016">
        <input type="text" size="40" id="day2" value="Jan 02 2017" style="display: block; margin-top:10px">
        <br>
        <button onclick="daysTotal()">Submit</button>
        <br>
        <div id="days" style="color:green; margin: 10px;"></div>
    </section>
    <h3>2. Ordered array of sales</h3>
    <input type="button" id="2" class="button" value="show solution" />
    <br>
    <br>
    <section id="section2" style="display:none">
        <p>1.2.	Develop a program which produces ordered array of sales. Input: array of objects with the following structure {amount: 10000, quantity: 10}. Output: new array of ordered sales. Array element structure should be: {amount: 10000, quantity: 10, Total: 100000}, where Total = amount * quantity. Please note that input array shall remain intact.</p>
        <div>input array</div>
        <form id="form1">
            <textarea rows="5" cols="30"
                id="arr">[{amount: 5000,quantity: 50},{amount: 3000,quantity: 60},{amount: 1000,quantity: 90},{amount: 2000,quantity: 20}]</textarea>
                <div>order by:</div>
            <p><input type="radio" name="sort" value="amount">amount <input type="radio" name="sort"
                    value="quantity">quantity <input type="radio" name="sort" value="Total" checked>Total </p>
            <button type="submit">Submit</button>
        </form>
        <div style="display: flex">
            <div id="inputArr" style="width:200px; color:green; margin: 10px;"></div>
            <div id="outputArr" style="width:200px; color:green; margin: 10px;"></div>
        </div>
    </section>
    <h3>3. Projected object</h3>
    <input type="button" id="3" class="button" value="show solution" />
    <section id="section3" style="display:none">
        <p>1.3.	Develop a program “Object Projection”. Input: any JSON object; prototype object. Output: projected object. Projected object structure shall be intersection of source object and prototype object structures. Values of properties in projected object shall be the same as values of respective properties in source object. </p>
            
        <form id="form2">
            <div>input object:</div>
            <textarea rows="5" cols="30"
                id="object">{a1: 1,a2: null,a3: 111,a4: {a7: { w: 7, q: 8 },a8: 8,a9: 9},a5: 50000}</textarea>
                <div>input prototype:</div>
            <textarea rows="5" cols="30" id="prototype">{a222: 22222,a3: 12,a4: {a7: { w: null },a8: 8888}}</textarea>
            <br>
            <button type="submit">Submit</button>
        </form>
        <div id="projected" style="width:200px; color:green; margin: 10px;"></div>      
    </section>
    <h3>4. Google Calendar REST API</h3>
    <div>works only on http://localhost:3000 it is Google API demand activate domain names to receive javascript client ID</div>
    <input type="button" id="4" class="button" value="show solution" />
    <section id="section4" style="display:none">
        <p>2.1.	Develop a program in JS which returns array of free/busy intervals in a given time period for any shared Google calendar. Input: shared Google calendar ID; time period (starting and ending moments). Output: array of busy intervals.
        </p>       
        <form id="form3">
            <div>input calendar ID:</div>
            <input type="text" size="40" id="calendarId" value="anton.molchanovskyi@gmail.com" style="display: block; margin:10px">
          
            <div>input date1:</div>
            <input type="text" size="40" id="date1" value="2021.03.10" style="display: block; margin:10px">            
            <div>input date2:</div>
            <input type="text" size="40" id="date2" value="2021.04.20" style="display: block; margin:10px">            
            <button type="submit">Submit</button>
        </form>
        <br>
        <div id="busyArr" style="color:green; margin: 10px;"></div>
    </section>
    <h3>5. prepare scripts executable on this Try-SQL Editor </h3>
    <input type="button" id="5" class="button" value="show solution" />
    <section id="section5" style="display:none">
        <h4> 3.1 Create tables and insert data</h4>
        <p>creating table user</p> 
        <span> CREATE TABLE user( [id] int, [firstName] varchar(255), [lastName] varchar(255),
        [email] varchar(255), [cultureID] int, [deleted] bit, [country] varchar(255), [isRevokeAccess] bit, [created]
        datetime);
        </span>
        <p>inserting data</p>
        <span> INSERT INTO user
        (id,firstName,lastName,email,cultureID,deleted,country,isRevokeAccess,created) VALUES(1, 'Victor', 'Shevchenko',
        'vs@ gmail.com', 1033, 1, 'US', 0, '2011-04-05'), (2, 'Alexander', 'Petrenko', 'ap@ gmail.com', 1034, 0, 'UA',
        0, '2014-05-01'), (3, 'Victor', 'Tarasenko', 'vu@gmail.com', 1033, 1, 'US', 1, '2015-07-03'), (4, 'Sergey',
        'Ivanenko', 'sergey@gmail.com', 1046, 0, 'UA', 1, '2010-02-02'), (5, 'Vitalii', 'Danilchenko', 'shumko@
        gmail.com', 1031, 0, 'UA', 1, '2014-05-01'), (6, 'Joe', 'Dou', 'joe@ gmail.com', 1032, 0, 'US', 1,
        '2009-01-01'), (7, 'Marko', 'Polo', 'marko@gmail.com', 1033, 1, 'UA', 1, '2015-07-03') ; 
        </span>
        <p>creating table group1 (group by - is SQL command, that`s why we can`t use word "group")</p>
        <span> CREATE TABLE group1( [id] int,
        [name] varchar(255), [created] datetime); 
        </span>
        <p>inserting data</p>
        <span>
         INSERT INTO group1(id,name,created) VALUES(10,
        'Support', '2010-02-02'), (12, 'Dev team', '2010-02-03'), (13, 'Apps team', '2011-05-06'), (14, 'TEST - dev
        team', '2013-05-06'), (15, 'Guest', '2014-02-02'), (16, 'TEST-QA-team', '2014-02-02'), (17, 'TEST-team',
        '2011-01-07') ; 
        </span>
        <p>creating table groupMembership</p>
        <span>
         CREATE TABLE groupMembership( [id] int, [userID] int,
        [groupID] int, [created] datetime);
        </span>
        <p>inserting data</p>
        <span> INSERT INTO groupMembership(id,userID,groupID,created)
        VALUES(110, 2, 10, '2010-02-02'), (112, 3, 15, '2010-02-03'), (114, 1, 10, '2014-02-02'), (115, 1, 17,
        '2011-05-02'), (117, 4, 12, '2014-07-13'), (120, 5, 15, '2014-06-15') ; 
        </span>
        <h4> 3.2 Select names of all empty test groups (group name starts with “TEST-”).            
        </h4>
        <span>
         SELECT name FROM group1 WHERE name like 'TEST-%' 
        </span>
         <h4> 3.3 Select user first names and last names for the users that have Victor as a first name and are not members of
            any test groups (they may be members of other groups or have no membership in any groups at all).
         </h4>
        <span> SELECT user.firstName, user.lastName FROM user, group1, groupMembership WHERE user.firstName like 'Victor%' AND
        groupMembership.userID = user.id AND group1.id = groupMembership.groupID AND user.id <> (SELECT user.id FROM
            user, group1, groupMembership WHERE group1.name LIKE 'TEST-%' AND groupMembership.userID = user.id AND
            group1.id = groupMembership.groupID) 
        </span>
        <h4> 3.4 Select users and groups for which user was created before the group for which he(she) is member of.            
        </h4>
        <span>
         SELECT user.firstName, user.lastName, group1.name FROM user,
            group1, groupMembership WHERE groupMembership.userID = user.id AND group1.id = groupMembership.groupID AND
            user.created < group1.created
        </span>
        </section>

                <script>

                    //show-hide solutions
                    let button = document.querySelectorAll('.button');

                    button.forEach((e) => {
                        e.addEventListener('click', function () {

                            let section = document.getElementById(`section${this.id}`);

                            if (!section.className.match(/\bactive\b/)) {
                                section.style.display = "block";
                                section.classList.add('active');
                                this.value = "hide solution X";
                                this.style.backgroundColor = "lightblue";
                            } else {
                                section.classList.remove('active');
                                section.style.display = "none";
                                this.value = "show solution";
                                this.style.backgroundColor = "lightgreen";
                            }
                        });
                    });

                    //1
                    let d1;
                    let d2;
                    function daysTotal() {
                        let input1 = document.getElementById("day1").value;
                        let input2 = document.getElementById("day2").value;
                        d1 = new Date(input1);
                        d2 = new Date(input2);

                        console.log(d1);
                        console.log(d2);

                        Date.prototype.daysTo = function (d2) {
                            let days = Math.round(Math.abs((this - d2) / (1000 * 60 * 60 * 24)));
                            console.log(days);
                            document.getElementById("days").innerHTML = `number of days: ${days}`;
                            return days;
                        }
                        d1.daysTo(d2)
                    }

                    //2
                    const form1 = document.getElementById("form1");

                    form1.addEventListener("submit", function (event) {
                        const data = new FormData(form1);
                        let output = "";
                        for (const entry of data) {
                            output = entry[1]
                        };
                        console.log("sort by:", output);

                        let x = document.getElementById("arr").value;
                        let inputArr = new Function('return (' + x + ')')();

                        //deep copy of inputArr
                        let outputArr = JSON.parse(JSON.stringify(inputArr));


                        for (i in outputArr) {
                            let total = outputArr[i].amount * outputArr[i].quantity;
                            outputArr[i].Total = total;
                        }

                        //sort by
                        function sortBy(outputArr, output) {
                            outputArr.sort((a, b) => a[output] > b[output] ? 1 : -1);

                        }
                        sortBy(outputArr, output);

                        console.log(inputArr);
                        console.log(outputArr);

                        let inputS = JSON.stringify(inputArr).replace(/"([^"]+)":/g, '$1:');
                        let outputS = JSON.stringify(outputArr).replace(/"([^"]+)":/g, '$1:');

                        document.getElementById("inputArr").innerHTML = `<p>input:</p> ${inputS}`;
                        document.getElementById("outputArr").innerHTML = `<p>output:</p> ${outputS}`;

                        event.preventDefault();
                    }, false);


                    //3


                    const form2 = document.getElementById("form2");

                    form2.addEventListener("submit", function (event) {

                        let y = document.getElementById("object").value;
                        let z = document.getElementById("prototype").value;

                        let object = new Function('return (' + y + ')')();
                        let prototype = new Function('return (' + z + ')')();

                        function projectedObj(object, prototype) {

                            let projected = {};

                            let objectKeys = Object.keys(object);
                            let prototypeKeys = Object.keys(prototype);

                            //array of projected keys that not undefined   
                            let projectedKeysArr = prototypeKeys.filter((a) => objectKeys.indexOf(a) !== -1);

                            for (let key in prototype) {
                                if (projectedKeysArr.includes(key)) {
                                    projected[key] = object[key];
                                }
                            }

                            console.log("object", object);
                            console.log("prototype", prototype);
                            console.log("projected", projected);

                            let projectedStr = JSON.stringify(projected).replace(/"([^"]+)":/g, '$1:');
                            document.getElementById("projected").innerHTML = `<p>projected:</p> ${projectedStr}`;
                            return projected;
                        }

                        projectedObj(object, prototype);
                        event.preventDefault();
                    }, false)

                    //4 
                    const form3 = document.getElementById("form3");



                    form3.addEventListener("submit", function (event) {
                        let calendarId = document.getElementById("calendarId").value;
                        let date1 = document.getElementById("date1").value;
                        let date2 = document.getElementById("date2").value;
                        console.log(calendarId)
                        console.log(date1)
                        console.log(date2)


                        function loadClient() {
                            gapi.client.setApiKey('AIzaSyAkl0q-uMXJ1pc26eiQ0QFfnPHgAITBV-8');
                            return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/calendar/v3/rest")
                                .then(function () { console.log("GAPI client loaded for API"); },
                                    function (err) { console.error("Error loading GAPI client for API", err); });
                        }

                        // Make sure the client is loaded and sign-in is complete before calling this method.

                        function execute() {
                            return gapi.client.calendar.freebusy.query({
                                "resource": {
                                    timeMin: new Date(date1).toISOString(),
                                    timeMax: new Date(date2).toISOString(),
                                    timeZone: 'NZ',
                                    items: [{ id: calendarId }]
                                }
                            })
                                .then(function (response) {
                                    // Handle the results here (response.result has the parsed body).
                                    console.log("response", response);
                                    let busy = response.result.calendars[calendarId].busy;

                                    if (undefined) {
                                        console.error('Check if this calendar has public free busy visibility');
                                    } else if (busy.length !== 0) {
                                        console.log("Busy", busy);
                                        let busyArr = JSON.stringify(busy).replace(/"([^"]+)":/g, '$1:');

                                        document.getElementById("busyArr").innerHTML = `<p>busyArr:</p> ${busyArr}`;
                                    } else {
                                        console.log('Free');
                                    }

                                },
                                    function (err) {
                                        console.error("error", err);
                                    })

                        }
                        gapi.load("client:auth2", async function () {
                            gapi.auth2.init({ client_id: '656079090087-q3lou9u3vpe2aq787991c45i73olg93r.apps.googleusercontent.com' });
                            await loadClient();
                            await execute();
                        })
                        event.preventDefault();
                    }, false);

                </script>
</body>

</html>